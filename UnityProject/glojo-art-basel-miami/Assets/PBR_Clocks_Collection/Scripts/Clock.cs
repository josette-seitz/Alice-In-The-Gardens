using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using static UnityEngine.GraphicsBuffer;

public class Clock : MonoBehaviour {
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
//
//                                          Simple Clock Script by Andre "AEG" Bürger /VIS-Games (2021)
//  
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------

    //-------------------------------------------------
    public bool hasPendulum = false;            
    public float speed = 1.0f;
    public int minute;      // start Time
    public int hour;        // start Time

    public float rotationSpeed = 150f;
    public bool rotate = false;
    public Transform targetClock;
    //-------------------------------------------------
    Transform handleMinute;
    Transform handleHour;
    Transform pendulum;
    //-------------------------------------------------
    float delay;
    float pendulumIndex;
    //-------------------------------------------------

//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
void Start()
{
    handleMinute = transform.Find("handle_minute");
    handleHour   = transform.Find("handle_hour");
    if(hasPendulum)
        pendulum = transform.Find("pendulum");
    
    pendulumIndex = Random.Range(0.0f, 360.0f);
}
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
void Update()
{
        if(rotate)
        {
            // Spin Clock and Move
            transform.Rotate(new Vector3(0, 0, rotationSpeed * Time.deltaTime));

            float speed = 0.08f * Time.deltaTime; // calculate distance to move
            transform.position = Vector3.MoveTowards(transform.position, targetClock.position, speed);
        }

        // Check if the position of the 2 clocks are close
        if (Vector3.Distance(transform.position, targetClock.position) < 0.001f && rotate)
        {
            targetClock.gameObject.SetActive(true);
            this.gameObject.SetActive(false);
        }

        //--------------------------------------------------------------------------------------------------------------------------
        if (hasPendulum)
    {
        pendulumIndex += Time.deltaTime * 2.0f;
        pendulum.localEulerAngles = new Vector3(0.0f, 0.0f, (Mathf.Sin(pendulumIndex) * 7.0f) );
    }
    //--------------------------------------------------------------------------------------------------------------------------
    delay -= Time.deltaTime * speed;
    if(delay < 0.0f)
    { 
        delay = 1.0f;

        minute++;
        if(minute >= 60)
        {
            minute = 0;
            hour++;
            if(hour >= 12)
                hour = 0;
        }
        handleMinute.localEulerAngles = new Vector3(0.0f, 0.0f,  ((360.0f / 60.0f) * minute) );
        handleHour.localEulerAngles   = new Vector3(0.0f, 0.0f, ((360.0f / 12.0f) * hour) + ((360.0f / (60.0f * 12.0f)) * minute) );
    }
    //--------------------------------------------------------------------------------------------------------------------------
}
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
//----------------------------------------------------------------------------------------------------------------------------------------------
}
